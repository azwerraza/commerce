{% extends 'master.html' %}
{% block body%}

<div id="project" class="project">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="titlepage">
          <h2>Featured Products</h2>
        </div>
      </div>
    </div>

<div class="product-grid-container">
            <!-- First Row -->
{% with seen_ids=[] %}
  {% for prod in page_obj %}
    {% if prod.id not in seen_ids %}
      {% with seen_ids=seen_ids|add:prod.id %}
  <div class="product-card">
    <div class="product-image">
      <a href="{% url 'product_detail' prod.id %}">
        <img src="{{ prod.image.url }}" alt="{{ prod.name }}" style="height: 300px; width: 100%; object-fit: cover;">
      </a>
          <!-- Add to Cart Icon Button -->
          {% if user.is_authenticated %}
        <a href="{% url 'cart_add' prod.id %}" class="cart-btn add-to-cart-btn" aria-label="Add to cart">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M19 7H16V6C16 4.89543 15.1046 4 14 4H10C8.89543 4 8 4.89543 8 6V7H5C4.44772 7 4 7.44772 4 8C4 8.55228 4.44772 9 5 9H6L7 19C7 20.1046 7.89543 21 9 21H15C16.1046 21 17 20.1046 17 19L18 9H19C19.5523 9 20 8.55228 20 8C20 7.44772 19.5523 7 19 7ZM10 6H14V7H10V6Z" fill="currentColor"/>
    </svg>
  </a>
{% else %}
  <!-- Show Login Prompt if not authenticated -->
<button type="button" onclick="showLoginPopup()" class="cart-btn add-to-cart-btn" aria-label="Login to add to cart">    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M19 7H16V6C16 4.89543 15.1046 4 14 4H10C8.89543 4 8 4.89543 8 6V7H5C4.44772 7 4 7.44772 4 8C4 8.55228 4.44772 9 5 9H6L7 19C7 20.1046 7.89543 21 9 21H15C16.1046 21 17 20.1046 17 19L18 9H19C19.5523 9 20 8.55228 20 8C20 7.44772 19.5523 7 19 7ZM10 6H14V7H10V6Z" fill="currentColor"/>
    </svg>
  </button>
{% endif %}

          {% if user.is_authenticated and prod.id in wishlist_items %}
  <!-- Filled Heart -->
  <a href="{% url 'wishlist_remove' prod.id %}" class="wishlist-btn active" aria-label="Remove from wishlist">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="red">
      <path d="M12.1 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5
               2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09
               C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5
               c0 3.78-3.4 6.86-8.55 11.54L12.1 21.35z" fill="currentColor"/>
    </svg>
  </a>
{% else %}
  <!-- Empty Heart -->
  <a href="{% url 'wishlist_add' prod.id %}" class="wishlist-btn" aria-label="Add to wishlist">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
      <path d="M12.1 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5
               2 5.42 4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09
               C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5
               c0 3.78-3.4 6.86-8.55 11.54L12.1 21.35z"
               stroke="red" stroke-width="2" fill="none"/>
    </svg>
  </a>
{% endif %}


        </div>

        <div class="product-info">
          <h3 class="product-title">Rs {{ prod.price }}</h3>
          <p class="product-price">{{ prod.name }}</p>
        </div>
      </div>
 {% endwith %}
    {% endif %}
  {% endfor %}
{% endwith %}


</div>
</div>
</div>



<div class="pagination">
  {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}">&laquo;</a>
  {% else %}
    <span class="disabled">&laquo;</span>
  {% endif %}

  {% for page_num in page_obj.paginator.page_range %}
    {% if page_obj.number == page_num %}
      <a href="?page={{ page_num }}" class="active">{{ page_num }}</a>
    {% else %}
      <a href="?page={{ page_num }}">{{ page_num }}</a>
    {% endif %}
  {% endfor %}

  {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}">&raquo;</a>
  {% else %}
    <span class="disabled">&raquo;</span>
  {% endif %}
</div>





<!-- Login Prompt Modal -->
<!-- Login Prompt Modal -->
<div id="loginModal" style="display: none; position: fixed; top: 30%; left: 50%; transform: translate(-50%, -50%);
     background-color: white; width: 600px; padding: 30px; border-radius: 12px;
     box-shadow: 0 8px 16px rgba(0, 0, 0, 0.25); z-index: 1000; text-align: center;">

  <p style="font-size: 18px; margin-bottom: 20px;">
    <strong>Have an account?</strong><br>Log in to use this feature.
  </p>

  <div style="margin-bottom: 20px;">
    <a href="{% url 'login' %}?next={{ request.path }}" class="btn btn-primary" style="margin-right: 15px;">Log in</a>
    <a href="{% url 'signup' %}?next={{ request.path }}" class="btn btn-secondary">Sign up</a>
  </div>

  <button onclick="closeLoginPopup()" class="btn btn-light" style="padding: 6px 16px;">Close</button>
</div>


<script>
  function showLoginPopup() {
    document.getElementById("loginModal").style.display = "block";
  }
  function closeLoginPopup() {
    document.getElementById("loginModal").style.display = "none";
  }
</script>

{% endblock%}